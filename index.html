<!DOCTYPE html>
<html lang="en-US">
<head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <title>372 Adventure</title>
    <meta name="description" content="A story game for the fans of the 372 Pages We'll Never Get Back podcast">

    <style>
        body, 
        figure { 
            margin: 0; 
        }
        body, 
        button {
            font-family: "SFMono-Regular", Consolas, "Liberation Mono", Menlo, Courier, monospace;
            font-size: 20px;
            max-width: 36em;
        }
        nav {
            background-color: black;
            display: flex;
            justify-content: space-between;
            padding: 10px;
        }
        nav,
        nav a {
            color: white;
        }
        main {
            text-align: justify;
            padding: 1em;
        }
        figure {
            margin-bottom: 1em;
        }
        figcaption {
            font-size: 16px;
        }

        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <nav>
        <div class="title">372 Adventure</div>
        <div>
            <a href="#game">Game</a>
            <a href="#about">About</a>
        </div>
    </nav>
    <main>
        <div id="screen-intro" class="screen">
            <figure>
                <q>Being human totally sucks most of the time. Video games are the only thing that makes life bearable.</q>
                <figcaption>James Halliday, <i>Ready Player One</i></figcaption>
            </figure>
            <figure>
                <q>A billionaire wrote that.</q>
                <figcaption>Conor Lestowka, “372 Pages We'll Never Get Back”, Episode 1</figcaption> <!-- 25:18 -->
            </figure>
            <p><button class="next">Ready Player One</button>
        </div>

        <div id="screen-prologue" class="screen hidden">
            <h1>Prologue</h1>
            <p>I put down my corn chips and scratched myself.
            <p>It's 2044, and I'm playing "The Oasis", the world's most popular online game. The creators named it after a game in a classic '10s book, Ready Player One. Like the game in the book, you can fly spaceships around and visit virtual planets containing everything imaginable. But the real game within the game is the monthly Hunt. Each month, the game designers choose a themed group of planets and hide a key on each one.
            <p>This month's contest was about to start. I finished my corn chips and put down the bag. As I stared at the screen, the subject of the new Hunt faded in to visibility:
            <p>372 Pages
            <p>What I can only describe as a Cheshire grin spread slowly over my face. Over the past few years, I had listened to every episode of the classic podcast eight times.
            <p>I watched every episode of the classic '80s show Mystery Science Theatre 3000, including the Netflix revival and the '30s VR series.
            <p>I continued to listen to Like Trees Walking, even though Dave Berge was now a cyborg. 
            <p>I memorized every riff from every movie that Rifftrax ever riffed.
            <p>I read all 29 of Conor Lastowka's published novels several times each.
            <p>I knew that Conor had appeared on Jeopardy, so I watched every episode of the show.
            <p>I convinced my drama teacher to let us put on "Ken Burns Babyfur" senior year.
            <p>I read every book on crows and mockingbirds at my local library.
            <p>I watched every 372 Pages documentary.
            <p>I even listened to all of the side projects.
            <p>The grin remained spread across my face like The Joker in the 1989 film Batman, played by Jack Nicholson. I switched my microphone on and said, "N3lson, you ready for this?"
            <p>A voice seemed to crackle over my headset. "Lord N3lson to you, crapburger!"
            <p>I shook my head, still grinning. I had never met N3lson in real life, but I instinctively knew he looked exactly like his Oasis avatar. "Then I expect the same courtesy, lamer."
            <p>N3lson laughed. "Alright, Odgen. Let's do this!"
            <p>"It's on," I whispered. "It's on like Red Dawn."
            <p><button id="b-intro" class="next">Go to Planet RP1</button>
        </div>

        <div id="screen-ready-player-one" class="screen hidden">
            <h1>Ready Player One</h1>
            <p>You land your spaceship (an exact replica of The Satellite of Love named "Nerdgasm") on the surface of Planet RP1. As you step through the hatch and onto the surface, you see a crowd of '80s people dressed in '80s clothes doing '80s things. You wonder if they are players or NPCs, but you're not sure and you don't really care. You push past them (not before pulling off several '80s dance moves), enter a squat building, and go down the stairs. At the bottom, you push open a door and enter...Aech's Basement! The coolest chat room anyone has ever seen. You feel like a flibbertigibbet as you survey the room and try to decide where the key could be hidden.
            <div class="choices">
                <button class="choice" data-choice="1" data-result="key">Browse the vintage role-playing game supplements</button>
                <button class="choice" data-choice="2" data-result="item">Search the closet on the far wall</button>
                <button class="choice" data-choice="3" data-result="lose">Check between the couch cushions</button>
            </div>
            <div class="results">
                <div class="result-1 hidden">
                    <p>You grab the Tomb of Horrors supplement off the top of the stack and start flipping pages. A metal object falls out of the book and into the shag carpet. You bend down and pick it up.
                    <p class="result-points">Gain the Classic '80s Key!
                    <button class="next">Go to Planet Armada</button>
                </div>
                <div class="result-2 hidden">
                    <p>You open the closet and find stacks upon stacks of weird tinned fish. On top of one stack, you see a Leopardon action figure!
                    <p class="result-points">Gain 10 points!
                    <button class="next">Go to Planet Armada</button>
                </div>
                <div class="result-3 hidden">
                    <p>The only things you find between the couch cushions are pieces of Capt'n Crunch and the TV remote. You settle onto the couch and flip on the TV. After sitting through several commercials advertising goods and workers, Family Ties starts playing. You realize you are watching Family Ties inside a video game and instantly become depressed.
                    <p class="result-points">Lose 1 life point!
                    <button class="next">Go to Planet Armada</button>
                </div>
            </div>
        </div>

        <div id="screen-armada" class="screen hidden">
            armada
        </div>

        <div id="screen-dead" class="screen hidden">
            <p>You died. But now you know what not to do.
            <p><button class="reset">Play again</button>
        </div>
    </main>
    <footer>
        
    </footer>

    <script>
        window.addEventListener('DOMContentLoaded', (event) => {
            let stats = {
                'health': 3,
                'keys': 0,
                'items': 0
            };
            let screenNames = ['screen-intro', 'screen-prologue', 'screen-ready-player-one', 'screen-armada'];
            let choiceButtons = document.querySelectorAll('.screen .choice');
            let nextButtons = document.querySelectorAll('.screen .next');
            let resetButtons = document.querySelectorAll('.reset');
            
            let getNextScreen = (currentId) => screenNames[screenNames.indexOf(currentId) + 1];
            let hide = (element) => element.style.display = 'none';
            let show = (element) => element.style.display = 'block';

            let advance = (current) => {
                let next = document.getElementById(getNextScreen(current.id));
                console.log(`Leaving ${current.id}`);
                hide(current);
                console.log(`Entering ${next.id}`);
                show(next);
            };

            let displayResult = (screenName, choice) => {
                console.log(`Result ${choice} for ${screenName}`);
                let choices = document.querySelectorAll(`#${screenName} .choices`)[0];
                hide(choices);
                let result = document.querySelectorAll(`#${screenName} .result-${choice}`)[0];
                show(result);
            };

            let findScreenByElement = (element) => {
                let parent = element.parentElement;
                
                while (parent !== null) {
                    if (parent.classList.contains('screen')) {
                        break;
                    }
                    parent = parent.parentElement;
                }

                return parent;
            };

            let reset = () => {
                window.location.reload(false);
            };

            let storeResult = (result) => {
                switch (result) {
                    case 'key':
                        stats.keys += 1;
                        break;
                    case 'item':
                        stats.items += 1;
                        break;
                    case 'lose':
                        stats.health -= 1;
                        break;
                    default:
                        console.error(`Error: storeResult() passed invalid 'result' param: ${result}`);
                        break;
                }

                console.log(stats);
            };



            Array.from(choiceButtons).forEach(button => {
                button.addEventListener('click', (clickEvent) => {
                    let button = clickEvent.target;
                    let screen = findScreenByElement(button);

                    let result = button.dataset.result;
                    console.log(`Result is ${result}`);
                    storeResult(result);

                    let choice = button.dataset.choice;
                    console.log(`User made choice ${choice}`);
                    displayResult(screen.id, choice);

                    if (stats.health <= 0) {
                        // display dead screen
                    }
                });
            });

            Array.from(nextButtons).forEach(button => {
                button.addEventListener('click', (clickEvent) => {
                    let screen = findScreenByElement(clickEvent.target);
                    advance(screen);
                });
            });

            Array.from(resetButtons).forEach(button => {
                button.addEventListener('click', (clickEvent) => {
                    reset();
                });
            });

            console.log(`Hello, fellow developer! I haven't obfuscated any code, so it's extremely easy to cheat. I only ask that you don't spoil the game for others.`);
            console.log(`If you find any bugs, please open an issue: https://github.com/briankoser/372adventure/issues/new`);
        });
    </script>
</body>
</html>